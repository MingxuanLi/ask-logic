var askjs_core=angular.module("askjs.core",[]);askjs_core.factory("AnswerStates",["Logger",function(a){function b(a){return null==a.choice?!1:!0}function c(a){return a.choices&&a.choices.length?!0:!1}function d(a){return null==a.number?!1:!0}function e(a){return null==a.text?!1:0==a.text.trim().length?!1:!0}function f(b,c){if(a.debug("checking if multitext question answered","ask.logic.answers"),a.debug(b,"ask.logic.answers"),!b.entries)return!1;if(b.entries.length<1)return!1;if(c.minEntries&&b.entries.length<c.minEntries)return!1;if(c.maxEntries&&b.entries.length>c.maxEntries)return!1;var d=!0;return _.each(b.entries,function(a){null==a&&(d=!1),0==a.trim().length&&(d=!1)}),d}function g(a){return a.rating?!0:!1}function h(a){return a.mood?!0:!1}function i(a){return a.choice}function j(a){return a.choices&&a.choices.length?a.choices.join(","):"none"}function k(a){return a.number?a.number:"unknown"}function l(a){return a.text?a.text:""}function m(a){return a.entries?a.entries.join():""}function n(a){return a.rating?a.rating:"unknown"}function o(a){return a.mood&&a.mood.name?a.mood.name:"nothing"}return{isAnswered:function(i,j){if(!i)return a.warn("tried to check answer to nonexistent field","ask.logic.answers"),!1;if(!j)return a.warn("tried to check undefined answer to field "+i.id,"ask.logic.answers"),!1;a.debug("checking if "+i.id+" is answered","ask.logic.answers");var k=!1;switch(i.type){case"singlechoice":k=b(j);break;case"multichoice":k=c(j);break;case"numeric":k=d(j);break;case"freetext":k=e(j);break;case"multitext":k=f(j,i);break;case"rating":k=g(j);break;case"mood":k=h(j);break;case"score":k=!0;break;default:a.warn("cannot check answer of unknown field type "+i.type+" ("+i.id+")","ask.logic.answers")}return k?a.debug(i.id+" IS answered","ask.logic.answers"):a.debug(i.id+" IS NOT answered","ask.logic.answers"),k},answerAsString:function(b,c){if(!b)return a.warn("tried to stringify answer to nonexistent field","ask.logic.answers"),null;if(!c)return a.warn("tried to stringify undefined answer to field "+b.id,"ask.logic.answers"),null;switch(b.type){case"singlechoice":return i(c);case"multichoice":return j(c);case"numeric":return k(c);case"freetext":return l(c);case"multitext":return m(c);case"rating":return n(c);case"mood":return o(c);default:a.warn("cannot stringify answer of unknown field type "+b.type+" ("+b.id+")","ask.logic.answers")}return null}}}]),askjs_core.factory("ChoiceGatherer",["Logger","Normalizer",function(a,b){function c(a){return a.text?[a.text]:[]}function d(a){return a.entries?a.entries:[]}function e(a){return a.choice?[a.choice]:[]}function f(a){return a.choices?a.choices:[]}function g(a){return a.mood?a.mood.name:[]}function h(b,h){switch(b.type){case"freetext":return c(h);case"multitext":return d(h);case"singlechoice":return e(h);case"multichoice":return f(h);case"mood":return g(h);default:a.warn("Tried to get autochoices from invalid field type "+b.type+" ("+b.id+")","ask.logic.choiceSources")}return[]}return{gatherChoices:function(a,c){var d=[],e=[];return _.each(a,function(a){var f=c.answers[a.id];null!=f&&_.each(h(a,f),function(a){var c=b.normalize(a);0!=c.length&&(_.contains(e,c)||(d.push({name:a}),e.push(a)))})}),d}}}]),askjs_core.factory("Initializer",["Logger","TriggerStates",function(a,b){function c(b){var c={};return _.each(b.fields,function(a){a.tags&&a.tags.length&&"pageBreak"!=a.type&&_.each(a.tags,function(b){c[b]||(c[b]=[]),c[b].push(a.id)},this)},this),a.debug("fieldIds: ",q),a.debug(c,q),c}function d(b){var c={};return _.each(b.fields,function(a){a.tags&&a.tags.length&&"pageBreak"==a.type&&_.each(a.tags,function(b){c[b]||(c[b]=[]),c[b].push(a.id)},this)},this),a.debug("pageIdsByTag","ask.logic.state.init"),a.debug(c,"ask.logic.state.init"),c}function e(a){switch(a.type){case"instruction":case"static":case"video":return"media";case"pageBreak":case"sectionBreak":return"structure";case"score":return"summary";default:return"question"}}function f(b,c){b.choiceSources&&_.each(b.choiceSources,function(d){var e=c[d];return e?(e.choiceDestinations||(e.choiceDestinations=[]),void(_.contains(e.choiceDestinations,b.id)||e.choiceDestinations.push(b.id))):void a.error("Could not identify choice source "+d,q)},this)}function g(b,c){"score"==b.type&&b.sources&&_.each(b.sources,function(d){var e=c[d.id];return e?(e.affectedScoreFields||(e.affectedScoreFields=[]),void e.affectedScoreFields.push(b.id)):void a.warn("could not identify score source "+d.id,q)},this)}function h(a){return _.each(a.choices,function(a){null==a.weight&&(a.weight=1)}),a}function i(a){return _.each(a.choices,function(a){null==a.weight&&(a.weight=1)}),a}function j(a){if(null==a.weights&&(a.weights=[0,a.length-1]),2==a.weights.length&&a.length>2){for(var b=[],c=0;c<a.length;c++)b.push(a.weights[0]+(a.weights[1]-a.weights[0])*(c/(a.length-1)));a.weights=b}return a}function k(a,b){switch(a.superType=e(a),("question"==a.superType||"summary"==a.superType)&&(a.affectedFieldRules=[],a.affectedPageRules=[]),a.affectingShowFieldRules=[],a.affectingHideFieldRules=[],f(a,b),g(a,b),a.type){case"singlechoice":a=h(a);break;case"multichoice":a=i(a);break;case"rating":a=j(a)}return a}function l(a,b){return a.relevantFields=[],a.pageRuleStates={},a.affectingRules=[],a.index=b,a}function m(a,c){_.each(b.getQuestionIds(a.trigger),function(b){var d=c.fieldsById[b];d.affectedFieldRules.push(a)},this);var d=o(a,"show",c.fieldIdsByTag);_.each(d,function(b){var d=c.fieldsById[b];d.affectingShowFieldRules.push(a)},this);var e=o(a,"hide",c.fieldIdsByTag);return _.each(e,function(b){var d=c.fieldsById[b];d.affectingHideFieldRules.push(a)},this),_.uniq(_.union(d,e))}function n(a,c){_.each(b.getQuestionIds(a.trigger),function(b){var d=c[b];d.affectedPageRules.push(a)},this)}function o(b,c,d){var e=[];return _.each(b.actions,function(a){a.action==c&&(null!=a.fieldId&&e.push(a.fieldId),a.tag&&d[a.tag]&&_.each(d[a.tag],function(a){e.push(a)},this))},this),a.debug("affected field ids for rule "+b.index+" "+c,q),a.debug(e,q),_.uniq(e)}function p(a){var b=0,c=0;return _.each(a.relevantFields,function(a){if("question"==a.superType&&!a.hidden)switch(b++,a.type){case"singlechoice":case"rating":c++}},this),0==c||c>1?!1:b>1?!1:!0}var q="ask.core.init";return{cloneAndAugmentSchema:function(b){var e={};e.id=b.id,e.readableId=b.readableId,e.fieldIdsByTag=c(b),e.pageIdsByTag=d(b),e.fields=[],e.fieldsById={},e.pages=[],e.pagesById={};var f;return _.each(b.fields,function(a,b){var c=_.cloneDeep(a);"pageBreak"==c.type?(f=l(c,e.pages.length),e.pages.push(f),e.pagesById[f.id]=f):(c=k(c,e.fieldsById),f||(f=l({},0),e.pages.push(f)),f.relevantFields.push(c),c.pageIndex=f.index,e.fields.push(c),e.fieldsById[c.id]=c)},this),a.debug("fields initialized",q),_.each(e.pages,function(a){a.canAutoadvance=p(a)}),e.fieldRules=[],_.each(b.fieldRules,function(a,b){var c=_.cloneDeep(a);c.index=b,c.affectedFieldIds=m(c,e),e.fieldRules.push(c)},this),a.debug("field rules initialized",q),e.pageRules=[],_.each(b.pageRules,function(a,b){var c=_.cloneDeep(a);c.index=b,n(c,e.fieldsById),e.pageRules.push(c)},this),a.debug("set up page rules","ask.logic.state.init"),e},initializeResponse:function(a,b){return a||(a={}),a.surveyId||(a.surveyId=b.id),a.answers||(a.answers={}),a.summaries||(a.summaries={}),a.pageIndex||(a.pageIndex=0),a.completedAt||(a.pageIndex>=b.pages.length?a.completedAt=(new Date).toISOString():a.completedAt=void 0),a.startedAt||(a.startedAt=(new Date).toISOString()),_.each(b.fields,function(b){switch(b.superType){case"question":a.answers[b.id]||(a.answers[b.id]={});break;case"summary":a.summaries[b.id]||(a.summaries[b.id]={})}}),a}}}]),askjs_core.factory("PlaceholderResolver",["Logger","AnswerStates",function(a,b){return{resolve:function(c,d){for(var e=/\[\[([^\]]+)\]\]/g,f="",g=e.exec(c),h=0;null!=g;){a.debug("found "+g[0]+"at "+g.index,"ask.logic.placeholder"),f+=c.substr(h,g.index-h);var i=g[1];a.debug("Resolving placeholder [["+i+"]]","ask.logic.placeholder");var j=d.schema.fieldsById[i];if(j){var k=d.response.answers[i];null!=k&&b.isAnswered(j,k)?f+=b.answerAsString(j,k):(f=f+"`unansweredQuestion:"+i+"`",a.warn("Could not find answer for placeholder "+i,"ask.logic.placeholder")),h=g.index+g[0].length,g=e.exec(c)}else a.warn("Could not find question for placeholder "+i,"ask.logic.placeholder")}return f+=c.substr(h)}}}]),askjs_core.factory("ScoreCalculator",["Logger","AnswerStates","Normalizer",function(a,b,c){function d(b,d){var e=_.find(b.choices,function(a){return c.normalize(a.name)==c.normalize(d.choice)});return e?e.weight:void a.warn("Could not find choice "+b.choice)}function e(a,b){var d=c.normalizeAll(b.choices),e=0;return _.each(a.choices,function(a){_.contains(d,c.normalize(a.name))&&(e+=a.weight)},this),e}function f(a,b){return a.weights[b.rating-1]}function g(a,b){var c=a;return c<b.range[0]&&(c=b.range[0]),c>b.range[1]&&(c=b.range[1]),c}function h(a,b){var c=g(a,b);return(c-b.range[0])/(b.range[1]-b.range[0])*100}function i(a,b){if(b.categories&&b.categories.length){var c=(g(a,b),1/b.categories.length),d=0;return _.each(b.categories,function(e,f){var g=e.range[1]-e.range[0];if(f<b.categories.length-1&&(g+=1),!(a<=e.range[0]))if(a>e.range[1])d+=c;else{var h=(a-e.range[0])/g;d+=h*c}},this),100*d}}function j(a,b){if(b.categories&&b.categories.length){var c=g(a,b),d=_.findLast(b.categories,function(a){return c>=a.range[0]&&c<=a.range[1]});return d?d.id:void 0}}return{getScoreForQuestion:function(a,c){if(!b.isAnswered(a,c))return 0;switch(a.type){case"singlechoice":return d(a,c);case"multichoice":return e(a,c);case"rating":return f(a,c)}},getScoreSummary:function(a,b){var c={score:a,percent:h(a,b),categoryNormalizedPercent:i(a,b)},d=j(a,b);return d&&(c.category=d),c}}}]),askjs_core.factory("SurveyStates",["Logger","TriggerStates","AnswerStates","Initializer","ChoiceGatherer","ScoreCalculator",function(a,b,c,d,e,f){function g(a,b){null==a.pageIndex&&(a.completedAt?a.pageIndex=b.pages.length:a.pageIndex=0),b.page=b.pages[a.pageIndex],_.each(b.pages,function(b,c){b.current=c==a.pageIndex},this)}function h(b){var c=!0;b.hidden&&(c=!1),"hide"==b.fieldRuleAction&&(c=!1),a.debug("field "+b.id+" v="+b.visible+" a="+b.fieldRuleAction,q),b.visible=c}function i(b,c,d){var f=c[b],g=[];_.each(f.choiceSources,function(b){var d=c[b];return d?void g.push(d):void a.error("Could not identify choice source "+b,q)},this),f.autochoices=e.gatherChoices(g,d)}function j(a){if(!a.affectingShowFieldRules.length&&!a.affectingHideFieldRules.length)return"show";if(a.affectingShowFieldRules.length){var b=_.find(a.affectingShowFieldRules,function(a){return!a.fired});return b?"hide":"show"}if(a.affectingHideFieldRules.length){var c=_.find(a.untriggeredHideFieldRule,function(a){return!a.fired});return c?"show":"hide"}}function k(a,b){switch(a.superType){case"question":return b.response.answers||(response.answers={}),b.response.answers[a.id]||(b.response.answers[a.id]={}),b.response.answers[a.id];case"summary":return b.response.summaries||(b.response.summaries={}),b.response.summaries[a.id]||(b.response.summaries[a.id]={}),b.response.summaries[a.id];default:return}}function l(a,b,c){switch(a.superType){case"question":return c.response.answers||(response.answers={}),void(c.response.answers[a.id]=b);case"summary":return c.response.summaries||(c.response.summaries={}),void(c.response.summaries[a.id]=b);default:return}}function m(a,b){var c=0;_.each(a.sources,function(a){var d=b.schema.fieldsById[a.id],e=k(d,b);e&&e.score&&(c+=e.score)},this);var d=k(a,b);if(d.score!=c){var e=f.getScoreSummary(c,a);l(a,e,b),b.handleFieldChanged(a.id,!0)}}function n(a){if(!a.schema.page)return!1;var b=_.find(a.schema.page.relevantFields,function(b){if("question"!=b.superType)return!1;if(b.hidden)return!1;if(b.optional)return!1;var d=c.isAnswered(b,a.response.answers[b.id]);return console.log(" - "+b.id+" "+d),!d});return null==b}function o(a,b,c){this.schema=d.cloneAndAugmentSchema(a),this.response=d.initializeResponse(b,this.schema),console.log(c),c?(this.config=_.clone(c),_.each(p,function(a,b){console.log(" - "+b+":"+a),(null===this.config[b]||void 0===this.config[b])&&(this.config[b]=a)},this)):this.config=p,console.log(this.config),this.handleResponseUpdated(this.response)}var p={autoAdvance:!1},q="ask.core.state";return o.prototype.handleResponseUpdated=function(b){a.debug("Response changed!",q),this.response=d.initializeResponse(b,this.schema),_.each(this.schema.fields,function(a){this.handleFieldChanged(a.id,!0)},this),_.each(this.schema.fields,function(a){h(a)},this),g(this.response,this.schema)},o.prototype.handleContinue=function(){if(console.log("attempting to continue"),console.log(this.response.pageIndex+" vs "+this.schema.pages.length),this.response.pageIndex>=this.schema.pages.length-1)return void(this.response.completedAt=(new Date).toISOString());var b=this.schema.pages[this.response.pageIndex],c=!1;if(_.each(b.relevantFields,function(d){d.visible&&"question"==d.superType&&(d.answered||d.hidden||d.optional||(a.debug("Required field "+d.id+" on page "+b.index+" is not answered","ask.logic.state.pageRules"),d.missing=!0,c=!0))}),!c){for(var d,e=this.response.pageIndex+1;e<this.schema.pages.length;e++){var f=this.schema.pages[e],h=_.find(f.pageRuleStates,function(a){return"skip"==a});if(!h){d=f;break}}console.log(d),d?this.response.pageIndex=d.index:(this.response.pageIndex=this.schema.pages.length,this.response.completedAt=(new Date).toISOString()),g(this.response,this.schema)}},o.prototype.handleBack=function(){if(this.response.completedAt=void 0,0!=this.response.pageIndex){for(var a,b=this.response.pageIndex-1;b>=0;b--){var c=this.schema.pages[b],d=_.find(c.pageRuleStates,function(a){return"skip"==a});if(!d){a=c;break}}a?this.response.pageIndex=a.index:this.response.pageIndex=0,g(this.response,this.schema)}},o.prototype.handleFieldChanged=function(d,e){a.debug(d+" changed",q);var g=this.schema.fieldsById[d];if(!g)return void a.warn("Could not find field "+d,q);var h=k(g,this);"question"==g.superType&&(g.answered=c.isAnswered(g,h),g.answered&&(g.missing=!1,h.score=f.getScoreForQuestion(g,h))),_.each(g.affectedFieldRules,function(c){a.debug("  checking fieldRule: "+c.index,"ask.logic.state.fieldRules");var d=b.isFired(c.trigger,this);d!=c.fired&&(c.fired=d,this.handleFieldRuleStateChanged(c))},this),_.each(g.affectedPageRules,function(c){a.debug("  checking pageRule: "+c.index,"ask.logic.state.pageRules");var d=b.isFired(c.trigger,this);d!=c.fired&&(c.fired=d,this.handlePageRuleStateChanged(c))},this),_.each(g.choiceDestinations,function(a){i(a,this.schema.fieldsById,this.response)},this),_.each(g.affectedScoreFields,function(a){var b=this.schema.fieldsById[a];m(b,this)},this);var j=this.schema.pages[this.response.pageIndex];if(this.config.autoAdvance&&j.canAutoadvance&&!e){var l=n(this);l&&this.handleContinue()}},o.prototype.handleFieldRuleStateChanged=function(b){a.debug("field rule state changed to "+b.fired,"ask.logic.state.rules"),a.debug(b.affectedFieldIds,"ask.logic.state.rules"),_.each(b.affectedFieldIds,function(b){var d=this.schema.fieldsById[b],e=j(d);a.debug("- "+b+" action is "+e,"ask.logic.state.rules"),e!=d.fieldRuleAction&&(d.fieldRuleAction=e,"hide"==d.fieldRuleAction&&"question"==d.superType&&c.isAnswered(d,k(d,this))&&(a.debug("Recursively clearing answer to "+d.id,"ask.logic.state"),l(d,{},this),this.handleFieldChanged(d.id,!0)),h(d))},this)},o.prototype.handlePageRuleStateChanged=function(c){a.debug("page rule state changed to "+c.fired,"ask.logic.state.pageRules"),a.debug(c,"ask.logic.state.pageRules");var d=b.getQuestionIds(c.trigger);a.debug(d,"ask.logic.state.pageRules");var e;_.each(d,function(b){var c=this.schema.fieldsById[b];a.debug("- "+b+" "+c.pageIndex,"ask.logic.state.pageRules"),(null==e||e<c.pageIndex)&&(e=c.pageIndex)},this),e++,a.debug("earliestEffectedPageIndex: "+e,"ask.logic.state.pageRules"),_.each(c.actions,function(a){switch(a.action){case"skip":var b=this.schema.pagesById[a.pageId];c.fired?b.pageRuleStates[c.index]="skip":b.pageRuleStates[c.index]=void 0;break;case"skipTo":for(var d=this.schema.pagesById[a.pageId],f=e;f<d.index;f++)c.fired?this.schema.pages[f].pageRuleStates[c.index]="skip":this.schema.pages[f].pageRuleStates[c.index]=void 0;break;case"skipToEnd":for(var f=e;f<this.schema.pages.length;f++)c.fired?this.schema.pages[f].pageRuleStates[c.index]="skip":this.schema.pages[f].pageRuleStates[c.index]=void 0}},this)},{init:function(a,b,c){return new o(a,b,c)}}}]),askjs_core.factory("TriggerStates",["Logger","Normalizer",function(a,b){function c(b){if(void 0!=b.questionId&&null!=b.questionId)return[b.questionId];if(b.and){var d=[];return _.each(b.and,function(a){d=_.union(d,c(a))}),d}if(b.or){var d=[];return _.each(b.or,function(a){d=_.union(d,c(a))}),d}return a.warn("could not identify type of trigger","ask.logic.triggers"),[]}function d(b,c){return a.debug(" - checking trigger "+JSON.stringify(b),"ask.logic.triggers"),void 0!=b.questionId||null!=b.questionId?g(b,c):void 0!=b.and||null!=b.and?e(b,c):void 0!=b.or||null!=b.or?f(b,c):(a.warn("could not identify type of trigger","ask.logic.triggers"),!1)}function e(a,b){var c=!0;return _.each(a.and,function(a){return d(a,b)?void 0:(c=!1,!1)}),c}function f(a,b){var c=!1;return _.each(a.or,function(a){return d(a,b)?(c=!0,!1):void 0}),c}function g(b,c){a.debug("checking fire state of "+JSON.stringify(b),"ask.logic.triggers");var d=c.schema.fieldsById[b.questionId];if(null==d)return a.warn('Could not identify field "'+b.questionId+'"',"ask.logic.triggers"),!1;var e=c.response.answers[b.questionId];if(null==e)return!1;var f=!1;switch(d.type){case"singlechoice":f=h(b,e);break;case"multichoice":f=i(b,e);break;case"numeric":f=j(b,e);break;case"freetext":f=k(b,e);break;case"multitext":f=l(b,e);break;case"rating":f=m(b,e);break;case"mood":f=n(b,e);break;default:a.warn("could not identify fire state of trigger for field type "+d.type,"ask.logic.triggers")}return f?a.debug(" - fired","ask.logic.triggers"):a.debug(" - not fired","ask.logic.triggers"),f}function h(c,d){if(a.debug(" - checking single choice trigger "+JSON.stringify(c),"ask.logic.triggers"),a.debug(" - - against "+JSON.stringify(d),"ask.logic.triggers"),null==d.choice)return!1;switch(c.condition){case"is":return b.normalize(d.choice)==b.normalize(c.choice);case"isNot":return b.normalize(d.choice)!=b.normalize(c.choice)}return!1}function i(a,c){if(null==c.choices)return!1;var d=b.normalizeAll(c.choices),e=d.indexOf(b.normalize(a.choice));switch(a.condition){case"contains":return e>=0;case"notContains":return 0>e}return!1}function j(a,b){if(void 0===b.number||null===b.number)return!1;switch(a.condition){case"equal":return b.number==a.number;case"greaterThan":return b.number>a.number;case"lessThan":return b.number<a.number}return!1}function k(a,c){if(!c.text)return!1;var d=b.normalize(c.text),e=b.normalize(a.text);switch(a.condition){case"is":return d==e;case"isNot":return d!=e;case"contains":return d.indexOf(e)>=0;case"startsWith":return 0==d.indexOf(e)}return!1}function l(a,c){switch(a.condition){case"countEquals":return c.entries.length==a.count;case"countGreaterThan":return c.entries.length>a.count;case"countLessThan":return c.entries.length<a.count}var d=b.normalize(a.entry),e=_.find(c.entries,function(c){var e=b.normalize(c);switch(a.condition){case"entryIs":return e==d;case"entryContains":return e.indexOf(d)>=0;case"entryStartsWith":return 0==e.indexOf(d)}return!1});return e?!0:!1}function m(a,b){if(void 0===b.rating||null===b.rating)return!1;switch(a.condition){case"equal":return b.rating==a.rating;case"greaterThan":return b.rating>a.rating;case"lessThan":return b.rating<a.rating}return!1}function n(a,b){if(!b.mood)return!1;switch(a.condition){case"is":return o(a.mood,b.mood);case"isNot":return!o(a.mood,b.mood);case"isNear":return p(a.mood,b.mood);case"isSameQuadrant":return q(a.mood)==q(b.mood)}return!1}function o(a,b){return Math.abs(a.valence-b.valence)>.05?!1:Math.abs(a.arousal-b.arousal)>.05?!1:!0}function p(a,b){return Math.abs(a.valence-b.valence)>.25?!1:Math.abs(a.arousal-b.arousal)>.25?!1:!0}function q(a){return a.arousal>=0?a.valence>=0?"ne":"nw":a.valence>=0?"se":"sw"}return{isFired:function(b,c,e){return a.debug("checking fire state of "+JSON.stringify(b),"ask.logic.triggers"),d(b,c,e)},getQuestionIds:function(b){a.debug("identifying question ids for "+JSON.stringify(b),"ask.logic.triggers");var d=c(b);return a.debug(d,"ask.logic.triggers"),d}}}]),askjs_core.factory("Normalizer",function(){function a(a){if(null==a)return"";var c=a.replace(b," ");return c=c.replace(/\s+/g," "),c=c.toLowerCase(),c=c.trim()}var b=/[\u2000-\u206F\u2E00-\u2E7F\\'!"#\$%&\(\)\*\+,\-\.\/:;<=>\?@\[\]\^_`\{\|\}~]/g;return{normalize:function(b){return a(b)},normalizeAll:function(b){return _.map(b,function(b){return a(b)})}}}),askjs_core.factory("Logger",["$log",function(a){function b(a){var b=a.split(".");for(i=b.length;i>=0;i--){var c=b.slice(0,i),d=c.join(".");if(e[d])return e[d]}return e["*"]}function c(a,c){c||(c="*");var e=b(c);return d[a]>=d[e]}var d={trace:0,debug:1,info:2,warn:3,error:4},e={};return e["*"]="warn",{setLogLevel:function(b,c){null==d[b]&&a.warn(b+" is not a valid log level"),c||(c="*"),e[c]=b},trace:function(b,d){c("trace",d)&&a.trace(b)},debug:function(b,d){c("debug",d)&&a.debug(b)},info:function(b,d){c("info",d)&&a.info(b)},warn:function(b,d){c("warn",d)&&a.warn(b)},error:function(b,d){c("error",d)&&a.error(b)}}}]);